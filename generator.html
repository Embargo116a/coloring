<!DOCTYPE html>
<html lang="ko">
<head>
  <meta charset="UTF-8">
  <title>ìƒì„±ê¸°</title>
  <style>
    body { font-family: Arial, sans-serif; }
    /* ë³´ë“œ ì»¨í…Œì´ë„ˆ: 450Ã—450px ê³ ì • */
    #genBoard {
      display: grid;
      grid-gap: 1px;
      background-color: lightgray;
      width: 450px;
      height: 450px;
      box-sizing: border-box;
      margin-bottom: 10px;
    }
    .genCell { }
    /* ê¸°ë³¸ ìƒ‰ ì„ íƒ ë²„íŠ¼ ìŠ¤íƒ€ì¼ */
    .gen-color-btn {
      width: 60px;
      height: 30px;
      margin: 2px;
      border: none;
      cursor: pointer;
    }
    .gen-color-btn.selected {
      border: 3px solid black;
    }
    textarea { resize: none; }
    /* ì‚¬ìš©ì ì§€ì • ë²„íŠ¼ ìŠ¤íƒ€ì¼ */
    #customColorBtn {
      width: 100px;
      height: 30px;
      margin: 2px;
      cursor: pointer;
    }
  </style>
</head>
<body>
  <h1>ìƒì„±ê¸°</h1>
  <div>
    <label>í–‰ ìˆ˜: <input id="genRows" type="number" value="15" min="1"></label>
    <label>ì—´ ìˆ˜: <input id="genCols" type="number" value="15" min="1"></label>
    <button onclick="newGenBoard()">ìƒˆ ë³´ë“œ ìƒì„±</button>
  </div>
  <br>
  <!-- ìƒ‰ ì„ íƒ ë²„íŠ¼ ì˜ì—­ -->
  <div id="colorButtonContainer">
    <label>ì…€ ìƒ‰ìƒ ì„ íƒ: </label>
    <button class="gen-color-btn" style="background-color:red;" data-color="red" onclick="setGenCurrentColor('red', this)">Red</button>
    <button class="gen-color-btn" style="background-color:green;" data-color="green" onclick="setGenCurrentColor('green', this)">Green</button>
    <button class="gen-color-btn" style="background-color:blue;" data-color="blue" onclick="setGenCurrentColor('blue', this)">Blue</button>
    <button class="gen-color-btn" style="background-color:yellow;" data-color="yellow" onclick="setGenCurrentColor('yellow', this)">Yellow</button>
    <button class="gen-color-btn" style="background-color:white; color:black;" data-color="white" onclick="setGenCurrentColor('white', this)">White</button>
    <!-- ì‚¬ìš©ì ì§€ì • ìƒ‰ìƒ ì„ íƒ ë²„íŠ¼ -->
    <button id="customColorBtn" onclick="openCustomColorPicker()">ì‚¬ìš©ì ì§€ì •</button>
  </div>
  <!-- ìˆ¨ê²¨ì§„ ìƒ‰ìƒ ì…ë ¥ì°½ -->
  <input type="color" id="customColorInput" style="display:none;" onchange="updateSelectedCustomColor(this.value)">
  <br>
  <div>
    <button onclick="changeAllGenCells()">ì „ì²´ ìƒ‰ ë³€ê²½</button>
  </div>
  <br>
  <!-- ë³´ë“œ ì˜ì—­ -->
  <div id="genBoard"></div>
  <br>
  <div>
    <label>ëª©í‘œ ìƒ‰: 
      <select id="genTargetColor">
        <option value="red" style="color:red;">Red</option>
        <option value="green" style="color:green;">Green</option>
        <option value="blue" style="color:blue;">Blue</option>
        <option value="yellow" style="color:yellow;">Yellow</option>
        <option value="white" style="color:black;">White</option>
      </select>
    </label>
    <label>ëª©í‘œ íšŸìˆ˜: <input id="genTargetMoves" type="number" value="4" min="1"></label>
    <button onclick="saveGenBoard()">ì €ì¥</button>
  </div>
  <br>
  <div>
    <textarea id="genSavedCode" cols="60" rows="5" readonly></textarea>
    <br>
    <button onclick="copyGenCode()">ë³µì‚¬</button>
  </div>
  
  <script>
    // ìƒì„±ê¸° ì „ìš© ë³€ìˆ˜
    let genBoardArray = [];
    let genRows = 15, genCols = 15;
    const genBoardSize = 450;  // ë³´ë“œ ì»¨í…Œì´ë„ˆ ê³ ì • í¬ê¸°(px)
    let genCurrentColor = "red"; // ì´ˆê¸° ì„ íƒ ìƒ‰ìƒ

    // ìƒˆ ë³´ë“œ ìƒì„±: ë³´ë“œ ë°°ì—´ì„ ëª©í‘œìƒ‰ìœ¼ë¡œ ì´ˆê¸°í™”
    function newGenBoard() {
      genRows = parseInt(document.getElementById("genRows").value);
      genCols = parseInt(document.getElementById("genCols").value);
      const targetColor = document.getElementById("genTargetColor").value;

      genBoardArray = [];
      for (let i = 0; i < genRows; i++) {
        genBoardArray[i] = [];
        for (let j = 0; j < genCols; j++) {
          genBoardArray[i][j] = targetColor;
        }
      }
      drawGenBoard();
    }
    
    // ë³´ë“œ ê·¸ë¦¬ê¸°: ì…€ í¬ê¸°ë¥¼ (450px - gap) Ã· (í–‰ ë˜ëŠ” ì—´ ìˆ˜)ë¡œ ê³„ì‚°
    function drawGenBoard() {
      const boardDiv = document.getElementById("genBoard");
      const gridGap = 1;  // grid-gap ê°’(px)
      const totalGapWidth = (genCols - 1) * gridGap;
      const totalGapHeight = (genRows - 1) * gridGap;
      const cellWidth = (genBoardSize - totalGapWidth) / genCols;
      const cellHeight = (genBoardSize - totalGapHeight) / genRows;
      
      boardDiv.style.gridTemplateColumns = `repeat(${genCols}, ${cellWidth}px)`;
      boardDiv.style.gridTemplateRows = `repeat(${genRows}, ${cellHeight}px)`;
      boardDiv.innerHTML = "";
      for (let i = 0; i < genRows; i++) {
        for (let j = 0; j < genCols; j++) {
          const cell = document.createElement("div");
          cell.className = "genCell";
          cell.style.backgroundColor = genBoardArray[i][j];
          cell.style.width = cellWidth + "px";
          cell.style.height = cellHeight + "px";
          cell.dataset.row = i;
          cell.dataset.col = j;
          cell.onclick = genCellClick;
          cell.onmouseover = function(e) {
            if (e.buttons === 1) {
              genCellClick(e);
            }
          };
          boardDiv.appendChild(cell);
        }
      }
    }
    
    // ì…€ í´ë¦­: í•´ë‹¹ ì…€ì˜ ìƒ‰ìƒì„ í˜„ì¬ ì„ íƒ ìƒ‰ìœ¼ë¡œ ë³€ê²½
    function genCellClick(e) {
      const i = e.target.dataset.row;
      const j = e.target.dataset.col;
      genBoardArray[i][j] = genCurrentColor;
      e.target.style.backgroundColor = genCurrentColor;
    }
    
    // ê¸°ë³¸ ìƒ‰ ë²„íŠ¼ í´ë¦­: í˜„ì¬ ì„ íƒ ìƒ‰ ì—…ë°ì´íŠ¸ ë° ë²„íŠ¼ ê°•ì¡°
    function setGenCurrentColor(color, btn) {
      genCurrentColor = color;
      const btns = document.querySelectorAll(".gen-color-btn");
      btns.forEach(b => b.classList.remove("selected"));
      btn.classList.add("selected");
    }
    
    // ì‚¬ìš©ì ì§€ì • ë²„íŠ¼ í´ë¦­: ìˆ¨ê²¨ì§„ ìƒ‰ìƒ ì…ë ¥ì°½ í™œì„±í™”
    function openCustomColorPicker() {
      document.getElementById("customColorInput").click();
    }
    
    // ìƒ‰ìƒ ì…ë ¥ì°½ ë³€ê²½ ì‹œ: í˜„ì¬ ì„ íƒëœ ê¸°ë³¸ ë²„íŠ¼ì˜ ìƒ‰ìƒì„ ì—…ë°ì´íŠ¸í•˜ê³ , ë³´ë“œì— ë°˜ì˜
    function updateSelectedCustomColor(newColor) {
      // ì´ì „ ì„ íƒ ìƒ‰ìƒì„ ê°€ì ¸ì˜´
      const oldColor = genCurrentColor;
      // í˜„ì¬ ì„ íƒëœ ë²„íŠ¼ ì—…ë°ì´íŠ¸ (ë§Œì•½ í˜„ì¬ ì„ íƒ ë²„íŠ¼ì´ ìˆë‹¤ë©´)
      const btns = document.querySelectorAll(".gen-color-btn");
      let targetBtn = null;
      btns.forEach(btn => {
        if (btn.classList.contains("selected") && btn.dataset.color === oldColor) {
          targetBtn = btn;
        }
      });
      if (targetBtn) {
        // ë²„íŠ¼ì˜ ë°°ê²½ìƒ‰, í…ìŠ¤íŠ¸, data-color ì—…ë°ì´íŠ¸
        targetBtn.style.backgroundColor = newColor;
        targetBtn.innerText = newColor;
        targetBtn.dataset.color = newColor;
      }
      // í˜„ì¬ ì„ íƒ ìƒ‰ì„ ìƒˆ ìƒ‰ìƒìœ¼ë¡œ ë³€ê²½
      genCurrentColor = newColor;
      // ë³´ë“œ ë°°ì—´ì—ì„œ ê¸°ì¡´ ìƒ‰(oldColor)ì„ ìƒˆ ìƒ‰(newColor)ë¡œ ì—…ë°ì´íŠ¸
      for (let i = 0; i < genRows; i++) {
        for (let j = 0; j < genCols; j++) {
          if (genBoardArray[i][j] === oldColor) {
            genBoardArray[i][j] = newColor;
          }
        }
      }
      drawGenBoard();
      // ëª©í‘œ ìƒ‰ <select> ì˜µì…˜ ì—…ë°ì´íŠ¸: ê¸°ì¡´ ì˜µì…˜ ì¤‘ valueê°€ oldColorì¸ ì˜µì…˜ì„ newColorë¡œ ë³€ê²½
      const targetSelect = document.getElementById("genTargetColor");
      for (let i = 0; i < targetSelect.options.length; i++) {
        if (targetSelect.options[i].value === oldColor) {
          targetSelect.options[i].value = newColor;
          targetSelect.options[i].text = newColor;
          // ì—…ë°ì´íŠ¸ ìƒ‰ìƒ ìŠ¤íƒ€ì¼: whiteì¸ ê²½ìš° í…ìŠ¤íŠ¸ ìƒ‰ì„ blackë¡œ ì„¤ì •
          targetSelect.options[i].style.color = (newColor === "white") ? "black" : newColor;
        }
      }
    }
    
    // ì „ì²´ ìƒ‰ ë³€ê²½: ë³´ë“œì˜ ëª¨ë“  ì…€ì„ í˜„ì¬ ì„ íƒ ìƒ‰ìœ¼ë¡œ ë³€ê²½
    function changeAllGenCells() {
      for (let i = 0; i < genRows; i++) {
        for (let j = 0; j < genCols; j++) {
          genBoardArray[i][j] = genCurrentColor;
        }
      }
      drawGenBoard();
    }
    
function saveGenBoard() {
  const targetColorStr = document.getElementById("genTargetColor").value;
  const targetMoves = parseInt(document.getElementById("genTargetMoves").value);

  // ğŸ“Œ í˜„ì¬ ì…€ ìƒ‰ìƒ ì„ íƒ ë²„íŠ¼ë“¤ì˜ ìƒ‰ì„ ê°€ì ¸ì™€ colorArray ë™ì  ìƒì„±
  let colorArray = [];
  document.querySelectorAll(".gen-color-btn").forEach(btn => {
    colorArray.push(btn.dataset.color);
  });

  // ğŸ“Œ ë³´ë“œ ë°°ì—´ì„ ìˆ«ì ë°°ì—´ë¡œ ë³€í™˜ (ê° ìƒ‰ìƒì˜ ì¸ë±ìŠ¤ë¥¼ ì €ì¥)
  const numericBoard = [];
  for (let i = 0; i < genRows; i++) {
    numericBoard[i] = [];
    for (let j = 0; j < genCols; j++) {
      numericBoard[i][j] = colorArray.indexOf(genBoardArray[i][j]);
    }
  }

  // ğŸ“Œ ëª©í‘œ ìƒ‰ìƒë„ ìƒ‰ ë°°ì—´ ë‚´ ì¸ë±ìŠ¤ë¡œ ì €ì¥
  const targetColor = colorArray.indexOf(targetColorStr);

  // ğŸ“Œ ì €ì¥í•  JSON ë°ì´í„° ìƒì„±
  const boardData = {
    rows: genRows,
    cols: genCols,
    target_color: targetColor,  // ëª©í‘œ ìƒ‰ìƒ (ìˆ«ì ì¸ë±ìŠ¤)
    target_moves: targetMoves,   // ëª©í‘œ íšŸìˆ˜
    board: numericBoard,         // ìˆ«ìë¡œ ë³€í™˜ëœ ë³´ë“œ ë°°ì—´
    colors: colorArray           // ìƒ‰ìƒ ë°°ì—´ (í•´ë‹¹ ìˆ«ìë¥¼ ìƒ‰ìƒìœ¼ë¡œ ë³€í™˜í•  ë•Œ ì‚¬ìš©)
  };

  // ğŸ“Œ JSON â†’ Base64 ì¸ì½”ë”© í›„ ì €ì¥
  const jsonStr = JSON.stringify(boardData);
  const encodedStr = btoa(jsonStr);
  document.getElementById("genSavedCode").value = encodedStr;
}
    
    // ì €ì¥ëœ ì½”ë“œ ë³µì‚¬
    function copyGenCode() {
      const savedCode = document.getElementById("genSavedCode");
      savedCode.select();
      document.execCommand("copy");
      alert("ì €ì¥ëœ ì½”ë“œê°€ ë³µì‚¬ë˜ì—ˆìŠµë‹ˆë‹¤.");
    }
    
    newGenBoard();
    // ì´ˆê¸° ì„ íƒ ìƒ‰ìƒ ë²„íŠ¼ ê°•ì¡° ì„¤ì •
    const initialGenBtn = document.querySelector(".gen-color-btn[data-color='red']");
    if (initialGenBtn) initialGenBtn.classList.add("selected");
  </script>
</body>
</html>
